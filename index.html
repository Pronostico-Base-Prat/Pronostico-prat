<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pron√≥stico Base Prat</title>
    <style>
        body { font-family: sans-serif; background: #e3effb; margin: 0; padding: 0; }
        header { background: #003366; color: white; text-align: center; padding: 20px; }
        .etiqueta-dia { background: #3498db; color: white; padding: 10px 30px; border-radius: 50px; font-weight: bold; display: inline-block; margin: 20px; }
        .contenedor-clima { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 10px; }
        .tarjeta { background: white; border-radius: 12px; padding: 20px; width: 280px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); border-top: 10px solid #003366; text-align: left; }
        h2 { margin: 0 0 10px 0; color: #003366; border-bottom: 2px solid #eee; padding-bottom: 5px; text-align: center; }
        .dato { margin: 8px 0; color: #333; font-size: 0.9rem; }
        .temp { font-size: 1rem; color: #d35400; font-weight: bold; margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px; }
    </style>
</head>
<body>
    <header>
        <h1>Base Naval Ant√°rtica "Capit√°n Arturo Prat"</h1>
        <p>Pron√≥stico Meteorol√≥gico - Puerto Soberan√≠a</p>
    </header>
    <div id="contenido-principal" style="text-align: center;">
        <p id="estado" style="padding: 50px;">Cargando pron√≥stico actualizado...</p>
    </div>

    <script>
        const enlaceCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQrxJhBvpk3JZuOMWpKPZ2PMi2DYFEjxhSTWMbx4i_EHHI6rh9frJuskRuaX-OXJqc_Akz6Dh5qLr72/pub?output=csv&cache=" + new Date().getTime();

        async function cargarClima() {
            try {
                const respuesta = await fetch(enlaceCSV);
                const texto = await respuesta.text();
                
                // Procesar filas de forma segura
                const filas = texto.split('\n').map(linea => {
                    return linea.split(/,(?=(?:(?:[^"]"){2})[^"]*$)/).map(c => c.trim().replace(/^"|"$/g, ''));
                }).filter(f => f.length > 5);

                const main = document.getElementById('contenido-principal');
                main.innerHTML = ""; 

                let diaActual = "";
                let contenedorActual = null;

                for (let i = 1; i < filas.length; i++) {
                    const col = filas[i];
                    if (!col[0]) continue;

                    if (col[0] !== diaActual) {
                        diaActual = col[0];
                        const divDia = document.createElement('div');
                        divDia.innerHTML = <div class="etiqueta-dia">${diaActual}</div>;
                        main.appendChild(divDia);
                        contenedorActual = document.createElement('div');
                        contenedorActual.className = 'contenedor-clima';
                        main.appendChild(contenedorActual);
                    }

                    contenedorActual.innerHTML += `
                        <div class="tarjeta">
                            <h2>${col[1]}</h2>
                            <p class="dato">‚òÅÔ∏è <strong>Nubosidad:</strong> ${col[2]}</p>
                            <p class="dato">üëÅÔ∏è <strong>Visibilidad:</strong> ${col[3]}</p>
                            <p class="dato">üå¨Ô∏è <strong>Viento:</strong> ${col[4]}</p>
                            <p class="dato">üåä <strong>Mar:</strong> ${col[5]}</p>
                            <p class="temp">üå°Ô∏è T¬∞ Aire: ${col[6]}<br>‚ùÑÔ∏è S. T√©rmica: ${col[7]}</p>
                            <p class="dato">‚ö†Ô∏è <strong>Riesgo:</strong> ${col[8] || 'Bajo'}</p>
                        </div>
                    `;
                }
            } catch (e) {
                document.getElementById('estado').innerHTML = "Error al conectar con el servidor.";
            }
        }
        cargarClima();
    </script>
</body>
</html>
