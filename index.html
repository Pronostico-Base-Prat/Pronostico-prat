<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteo Prat | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-base: #0a2540; --color-secundario: #004e92;
            --bg-body: #f0f2f5; --riesgo-bajo: #2ecc71;
        }
        body { font-family: 'Roboto', sans-serif; background: var(--bg-body); margin: 0; padding: 0; }
        header { background: linear-gradient(135deg, var(--color-base), var(--color-secundario)); color: white; padding: 1.5rem; text-align: center; }
        header h1 { margin: 0; font-size: 1.5rem; text-transform: uppercase; }
        #dashboard { max-width: 1200px; margin: 20px auto; padding: 0 15px; }
        .seccion-dia { margin-bottom: 40px; text-align: center; }
        .titulo-dia { background: var(--color-base); color: white; padding: 8px 20px; border-radius: 4px; display: inline-block; margin-bottom: 15px; font-weight: bold; }
        .grid-tarjetas { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 10px; padding: 20px; border-left: 6px solid var(--riesgo-bajo); text-align: left; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .card-header h3 { margin: 0; color: var(--color-base); font-size: 1.1rem; }
        .badge-riesgo { font-size: 0.7rem; padding: 3px 8px; border-radius: 12px; color: white; background: var(--riesgo-bajo); font-weight: bold; }
        .fila-dato { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; border-bottom: 1px solid #f9f9f9; }
        .label { color: #666; } .valor { font-weight: 500; text-align: right; color: #111; }
        .bloque-temp { background: #f8f9fa; border-radius: 8px; padding: 10px; margin-top: 15px; display: flex; justify-content: space-around; }
        .temp-item { display: flex; flex-direction: column; text-align: center; }
        .temp-val { font-size: 1.1rem; font-weight: bold; color: var(--color-secundario); }
        .temp-lbl { font-size: 0.7rem; color: #777; }
        #footer-status { text-align: center; padding: 20px; color: #777; font-size: 0.8rem; }
    </style>
</head>
<body>

    <header>
        <h1>Base Naval Ant√°rtica "Capit√°n Arturo Prat"</h1>
        <p>Pron√≥stico Meteorol√≥gico Oficial</p>
    </header>

    <div id="dashboard"></div>
    <div id="footer-status">Cargando pron√≥stico...</div>

    <script>
        const URL_BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQrxJhBvpk3JZuOMWpKPZ2PMi2DYFEjxhSTWMbx4i_EHHI6rh9frJuskRuaX-OXJqc_Akz6Dh5qLr72/pub?output=csv";

        async function actualizarDatos() {
            try {
                const response = await fetch(URL_BASE + "&nocache=" + Date.now());
                const rawData = await response.text();
                
                // Limpiador: Solo procesamos l√≠neas que empiecen con texto real (como "Lunes" o "Martes")
                const filas = rawData.split(/\r?\n/)
                    .map(linea => linea.split(',').map(celda => celda.replace(/"/g, '').trim()))
                    .filter(f => f.length >= 8 && (f[0].includes("unes") || f[0].includes("artes") || f[0].includes("i√©rcoles") || f[0].includes("ueves") || f[0].includes("iernes") || f[0].includes("√°bado") || f[0].includes("omingo")));

                const dashboard = document.getElementById('dashboard');
                dashboard.innerHTML = "";
                
                let diaActual = "";
                let gridActual = null;

                filas.forEach(col => {
                    // Crear secci√≥n de d√≠a
                    if (col[0] !== diaActual) {
                        diaActual = col[0];
                        const seccion = document.createElement('div');
                        seccion.className = 'seccion-dia';
                        seccion.innerHTML = `<div class="titulo-dia">üìÖ ${diaActual}</div>`;
                        gridActual = document.createElement('div');
                        gridActual.className = 'grid-tarjetas';
                        seccion.appendChild(gridActual);
                        dashboard.appendChild(seccion);
                    }

                    // Renderizar tarjeta
                    gridActual.innerHTML += `
                        <div class="card">
                            <div class="card-header">
                                <h3>üïí ${col[1]}</h3>
                                <span class="badge-riesgo">${col[8] || 'Bajo'}</span>
                            </div>
                            <div class="fila-dato"><span class="label">‚òÅÔ∏è Nubes</span><span class="valor">${col[2]}</span></div>
                            <div class="fila-dato"><span class="label">üëÅÔ∏è Visib.</span><span class="valor">${col[3]}</span></div>
                            <div class="fila-dato"><span class="label">üå¨Ô∏è Viento</span><span class="valor">${col[4]}</span></div>
                            <div class="fila-dato"><span class="label">üåä Mar</span><span class="valor">${col[5]}</span></div>
                            <div class="bloque-temp">
                                <div class="temp-item"><span class="temp-val">${col[6]}</span><span class="temp-lbl">T¬∞ Aire</span></div>
                                <div class="temp-item"><span class="temp-val">${col[7]}</span><span class="temp-lbl">S. T√©rmica</span></div>
                            </div>
                        </div>`;
                });

                document.getElementById('footer-status').innerHTML = `‚úÖ √öltima actualizaci√≥n: ${new Date().toLocaleTimeString()}`;
            } catch (e) {
                console.error(e);
                document.getElementById('footer-status').innerHTML = "‚ö†Ô∏è Error de datos. Reintentando...";
            }
        }

        actualizarDatos();
        setInterval(actualizarDatos, 60000); // Actualiza cada minuto para mayor frescura
    </script>
</body>
</html>
