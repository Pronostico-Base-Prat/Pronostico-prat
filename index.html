<script>
const enlaceCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQrxJhBvpk3JZuOMWpKPZ2PMi2DYFEjxhSTWMbx4i_EHHI6rh9frJuskRuaX-OXJqc_Akz6Dh5qLr72/pub?output=csv";

async function cargarClima() {
    const main = document.getElementById("contenido-principal");
    main.innerHTML = "<p style='padding:50px;'>Cargando datos...</p>";

    try {
        const respuesta = await fetch(enlaceCSV + "&t=" + new Date().getTime());
        if (!respuesta.ok) throw new Error("No se pudo acceder al CSV");

        const texto = await respuesta.text();
        if (!texto.trim()) throw new Error("El CSV estÃ¡ vacÃ­o");

        const filas = texto.split("\n").map(f => f.split(","));

        if (filas.length <= 1) {
            main.innerHTML = "<p style='padding:50px;'>No hay datos disponibles.</p>";
            return;
        }

        main.innerHTML = "";

        let diaActual = "";
        let contenedorActual;

        for (let i = 1; i < filas.length; i++) {

            const col = filas[i];
            if (!col[0]) continue;

            if (col[0] !== diaActual) {
                diaActual = col[0];

                const etiqueta = document.createElement("div");
                etiqueta.className = "etiqueta-dia";
                etiqueta.textContent = diaActual;
                main.appendChild(etiqueta);

                contenedorActual = document.createElement("div");
                contenedorActual.className = "contenedor-clima";
                main.appendChild(contenedorActual);
            }

            const tarjeta = document.createElement("div");
            tarjeta.className = "tarjeta";

            tarjeta.innerHTML = `
                <h2>${col[1] || ""}</h2>
                <p class="dato">â˜ï¸ <strong>Nubosidad:</strong> ${col[2] || ""}</p>
                <p class="dato">ğŸ‘ï¸ <strong>Visibilidad:</strong> ${col[3] || ""}</p>
                <p class="dato">ğŸŒ¬ï¸ <strong>Viento:</strong> ${col[4] || ""}</p>
                <p class="dato">ğŸŒŠ <strong>Mar:</strong> ${col[5] || ""}</p>
                <p class="temp">ğŸŒ¡ï¸ TÂ° Aire: ${col[6] || ""}<br>
                â„ï¸ S. TÃ©rmica: ${col[7] || ""}</p>
                <p class="dato">âš ï¸ <strong>Riesgo:</strong> ${col[8] || "Bajo"}</p>
            `;

            contenedorActual.appendChild(tarjeta);
        }

    } catch (error) {
        main.innerHTML = "<p style='padding:50px; color:red;'>Error al cargar datos. Verifique que el CSV estÃ© publicado.</p>";
        console.error(error);
    }
}

cargarClima();
</script>
